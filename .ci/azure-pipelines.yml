parameters:
  - name: RunTests
    type: boolean
    default: true

trigger:
  batch: true
  branches:
    include:
      - develop
      - release

resources:
  repositories:
    - repository: templates
      type: git
      name: LFM.Pipelines

stages:
  - stage: publish_package
    displayName: Build
    jobs:
      - template: build.yml

  - stage: test_application
    displayName: Test
    condition: and(succeeded(), or(eq(variables['Build.Reason'], 'PullRequest'), eq(${{ parameters.RunTests }}, true)))
    jobs:
      - template: security-scan.yml@templates
        parameters:
          organization: lifemanager
          projectKey: ThijmenBrand_LFM.Authorization
          projectName: LFM.Authorization

  - stage: deploy_application
    displayName: Deploy
    jobs:
      - template: build.yml@templates
        parameters:
          applicationName: "lfm-authorization"
          dockerfile: "LFM.Authorization/Dockerfile"
